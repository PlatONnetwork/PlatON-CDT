include(ExternalProject)
find_package(Git REQUIRED)
include(GNUInstallDirs)

set(LLVM_BINDIR ${CMAKE_BINARY_DIR}/platon_llvm/bin)
set(LIBS_CMAKE_ARGS
  -DBINARY_DIR=${CMAKE_BINARY_DIR}
  -DCMAKE_C_COMPILER=${LLVM_BINDIR}/clang${BIN_SUFFIX}
  -DCMAKE_CXX_COMPILER=${LLVM_BINDIR}/clang++${BIN_SUFFIX}
  -DCMAKE_AR=${LLVM_BINDIR}/llvm-ar${BIN_SUFFIX}
  -DCMAKE_RANLIB=${LLVM_BINDIR}/llvm-ranlib${BIN_SUFFIX})
if (WIN32)
  list(APPEND LIB_CMAKE_ARGS -DCMAKE_MAKE_PROGRAM=${CMAKE_MAKE_PROGRAM})
endif()

ExternalProject_Add(
  PlatonWasmLibs
  CMAKE_ARGS ${LIBS_CMAKE_ARGS}
  SOURCE_DIR "${CMAKE_SOURCE_DIR}/libraries"
  BINARY_DIR "${CMAKE_BINARY_DIR}/libraries"
  UPDATE_COMMAND ""
  PATCH_COMMAND ""
  TEST_COMMAND ""
  INSTALL_COMMAND ""
  BUILD_ALWAYS 1
  DEPENDS PlatonLLVM
  )
